<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.control.Button?>
<?import javafx.scene.control.ComboBox?>
<?import javafx.scene.control.DatePicker?>
<?import javafx.scene.control.Label?>
<?import javafx.scene.control.TableColumn?>
<?import javafx.scene.control.TableView?>
<?import javafx.scene.control.TextArea?>
<?import javafx.scene.control.TextField?>
<?import javafx.scene.control.ToggleButton?>
<?import javafx.scene.control.ToggleGroup?>
<?import javafx.scene.control.Tooltip?>
<?import javafx.scene.image.Image?>
<?import javafx.scene.image.ImageView?>
<?import javafx.scene.layout.BorderPane?>
<?import javafx.scene.layout.ColumnConstraints?>
<?import javafx.scene.layout.GridPane?>
<?import javafx.scene.layout.HBox?>
<?import javafx.scene.layout.RowConstraints?>
<?import javafx.scene.layout.VBox?>

<BorderPane fx:id="root" minHeight="600" minWidth="1200" prefHeight="600" prefWidth="1400" stylesheets="@../css/venta.css" xmlns="http://javafx.com/javafx/24.0.1" xmlns:fx="http://javafx.com/fxml/1" fx:controller="com.robin.pos.controller.VentaController">

    <center>
        <HBox spacing="10" styleClass="main-container">
            <padding>
                <Insets bottom="10" left="10" right="10" top="10" />
            </padding>

            <!-- ============================================ -->
            <!-- PANEL IZQUIERDO: DATOS DEL CLIENTE Y VENTA -->
            <!-- ============================================ -->
            <VBox spacing="8" styleClass="panel-cliente" HBox.hgrow="NEVER">
                <HBox.margin>
                    <Insets right="5" />
                </HBox.margin>

                <!-- Secci贸n: Documento de Identidad -->
                <VBox spacing="5" styleClass="seccion-documento">
               <Label prefHeight="18.0" prefWidth="114.0" styleClass="label-seccion" text="Documento Pago" />
               <HBox alignment="CENTER" spacing="0">
                  <children>
                     <ToggleButton fx:id="btnBoleta" onAction="#onBoleta" prefHeight="26.0" prefWidth="104.0" styleClass="btn-DocuPaga" text="BOLETA">
                        <toggleGroup>
                           <ToggleGroup fx:id="tipoDocumentoGroup" />
                        </toggleGroup>
                     </ToggleButton>
                     <ToggleButton fx:id="btnFactura" onAction="#onFactura" prefHeight="26.0" prefWidth="104.0" styleClass="btn-DocuPaga" text="FACTURA" toggleGroup="$tipoDocumentoGroup" />
                  </children>
               </HBox>
                    <Label prefHeight="18.0" prefWidth="126.0" styleClass="label-seccion" text="Tipo Documento" />
                    <HBox spacing="5">
                       <ComboBox fx:id="cbxDocIdentidad" maxWidth="Infinity" onAction="#escogerTipoDocumento" prefHeight="30.0" prefWidth="160.0" promptText="Seleccione...">
                           <tooltip>
                               <Tooltip text="Seleccione el tipo de documento" />
                           </tooltip>
                       </ComboBox>
                        <TextField fx:id="txtNumDoc" onKeyPressed="#buscarClienteNumId" prefHeight="30.0" prefWidth="174.0" promptText="Ingrese n煤mero..." HBox.hgrow="ALWAYS">
                            <tooltip>
                                <Tooltip text="Presione Enter para buscar" />
                            </tooltip>
                        </TextField>

                        <Button fx:id="btnBuscarCliente" onAction="#buscarCliente" styleClass="btn-icon">
                            <graphic>
                                <ImageView fitHeight="18" fitWidth="18" preserveRatio="true">
                                    <Image url="@../imagenes/buscarCliente16.png" />
                                </ImageView>
                            </graphic>
                            <tooltip>
                                <Tooltip text="Buscar cliente" />
                            </tooltip>
                        </Button>

                        <Button fx:id="btnNuevoCliente" onAction="#nuevoCliente" styleClass="btn-icon">
                            <graphic>
                                <ImageView fitHeight="18" fitWidth="18" preserveRatio="true">
                                    <Image url="@../imagenes/newCliente16.png" />
                                </ImageView>
                            </graphic>
                            <tooltip>
                                <Tooltip text="Nuevo cliente" />
                            </tooltip>
                        </Button>
                    </HBox>
                </VBox>

                <!-- Secci贸n: Datos del Cliente -->
                <VBox spacing="5" VBox.vgrow="ALWAYS">
                    <Label fx:id="lblRazSocNom" styleClass="label-seccion" text="Raz贸n Social / Nombre" />
                    <TextArea fx:id="txtRazSocNom" prefRowCount="2" promptText="Raz贸n Social / Nombre del cliente" text="CLIENTES VARIOS" wrapText="true" />

                    <Label styleClass="label-seccion" text="Direcci贸n" />
                    <TextArea fx:id="txtDireccion" prefRowCount="2" promptText="Direcci贸n del cliente" wrapText="true" />

                    <Label styleClass="label-seccion" text="Fecha" />
                    <DatePicker fx:id="txtFechaVenta" maxWidth="Infinity">
                        <tooltip>
                            <Tooltip text="Fecha de la venta" />
                        </tooltip>
                    </DatePicker>

                    <Label styleClass="label-seccion" text="Moneda" />
                    <ComboBox fx:id="cbxMoneda" maxWidth="Infinity" promptText="SOL">
                        <tooltip>
                            <Tooltip text="Moneda de la transacci贸n" />
                        </tooltip>
                    </ComboBox>

                    <Label styleClass="label-seccion" text="Forma de Pago" />
                    <ComboBox fx:id="cbxFormaPago" maxWidth="Infinity" promptText="VENTA CONTADO">
                        <tooltip>
                            <Tooltip text="Seleccione forma de pago" />
                        </tooltip>
                    </ComboBox>

                    <Label styleClass="label-seccion" text="Motivo Contingencia" />
                    <ComboBox fx:id="cbxMotConting" maxWidth="Infinity" promptText="Facturaci贸n Electr贸nica">
                        <tooltip>
                            <Tooltip text="Motivo de contingencia" />
                        </tooltip>
                    </ComboBox>
               <Label fx:id="lblGuiaRemision" prefHeight="18.0" prefWidth="126.0" styleClass="label-seccion" text="Gu铆a de Remisi贸n" />
               <TextField fx:id="txtGuiaRemision" onKeyPressed="#buscarClienteNumId" prefHeight="30.0" prefWidth="174.0" promptText="Ingrese n煤mero de gu铆a remisi贸n">
                  <tooltip>
                     <Tooltip text="Presione Enter para buscar" />
                  </tooltip>
               </TextField>
                </VBox>
            </VBox>

            <!-- ===================================== -->
            <!-- PANEL CENTRAL: TABLA DE PRODUCTOS -->
            <!-- ===================================== -->
            <VBox prefHeight="579.0" prefWidth="665.0" spacing="10" styleClass="panel-productos" HBox.hgrow="ALWAYS">

                <!-- Tabla de Venta -->
                <TableView fx:id="tVenta" onKeyPressed="#tVentaKeyPressed" styleClass="tabla-venta" VBox.vgrow="ALWAYS">
                    <columns>
                        <TableColumn fx:id="colItem" minWidth="37.599915742874146" prefWidth="42.399964570999146" resizable="false" text="Item" />
                        <TableColumn fx:id="colDescripcion" minWidth="180.00000381469727" prefWidth="402.4000053405762" text="Descripci贸n" />
                        <TableColumn fx:id="colCantidad" minWidth="0.0" prefWidth="59.199981689453125" text="Cant." />
                        <TableColumn fx:id="colPrecio" minWidth="89.59991455078125" prefWidth="97.59991455078125" text="Precio Unit." />
                        <TableColumn fx:id="colTotal" minWidth="94.39990234375" prefWidth="112.0" text="Total" />
                    </columns>
                    <placeholder>
                        <Label styleClass="placeholder-text" text="No hay productos agregados" />
                    </placeholder>
                </TableView>

                <!-- Panel de C谩lculos y Total -->
                <HBox alignment="CENTER_RIGHT" spacing="10">
                   <!-- Barra de herramientas -->
                   <HBox prefHeight="218.0" prefWidth="149.0" spacing="5" styleClass="toolbar">
                       <Button fx:id="btnAgregarProducto" minWidth="26.0" onAction="#agregarProductoVenta" prefHeight="38.0" prefWidth="26.0" styleClass="btn-toolbar, btn-add">
                           <graphic>
                               <ImageView fitHeight="28.0" fitWidth="32.0" preserveRatio="true">
                                   <Image url="@../imagenes/agregar32.png" />
                               </ImageView>
                           </graphic>
                           <tooltip>
                               <Tooltip text="Agregar producto (Insert)" />
                           </tooltip>
                       </Button>
   
                       <Button fx:id="btnEliminarProducto" onAction="#eliminarProductoVenta" styleClass="btn-toolbar, btn-delete">
                           <graphic>
                               <ImageView fitHeight="27.0" fitWidth="34.0" preserveRatio="true">
                                   <Image url="@../imagenes/eliminar32.png" />
                               </ImageView>
                           </graphic>
                           <tooltip>
                               <Tooltip text="Eliminar producto (Supr)" />
                           </tooltip>
                       </Button>
                   </HBox>
                    <!-- C谩lculos detallados -->
                    <GridPane hgap="10" prefHeight="218.0" prefWidth="263.0" styleClass="panel-calculos" vgap="8">
                        <padding>
                            <Insets bottom="15" left="15" right="15" top="15" />
                        </padding>

                        <columnConstraints>
                            <ColumnConstraints hgrow="NEVER" minWidth="80" />
                            <ColumnConstraints hgrow="ALWAYS" minWidth="100" prefWidth="120" />
                        </columnConstraints>

                        <Label styleClass="label-calculo" text="Pago:" GridPane.rowIndex="0" />
                        <TextField fx:id="txtPago" alignment="CENTER_RIGHT" onKeyPressed="#calcularVuelto" styleClass="campo-calculo" text="0.00" GridPane.columnIndex="1" GridPane.rowIndex="0">
                            <tooltip>
                                <Tooltip text="Monto entregado por el cliente" />
                            </tooltip>
                        </TextField>

                        <Label styleClass="label-calculo" text="Vuelto:" GridPane.rowIndex="1" />
                        <TextField fx:id="txtVuelto" alignment="CENTER_RIGHT" editable="false" styleClass="campo-readonly" text="0.00" GridPane.columnIndex="1" GridPane.rowIndex="1" />

                        <Label styleClass="label-calculo" text="Sub Total:" GridPane.rowIndex="2" />
                        <TextField fx:id="lblSubTotal" alignment="CENTER_RIGHT" editable="false" styleClass="campo-readonly" text="0.00" GridPane.columnIndex="1" GridPane.rowIndex="2" />

                        <Label styleClass="label-calculo" text="IGV (18%):" GridPane.rowIndex="3" />
                        <TextField fx:id="lblIgv" alignment="CENTER_RIGHT" editable="false" styleClass="campo-readonly" text="0.00" GridPane.columnIndex="1" GridPane.rowIndex="3" />

                        <Label styleClass="label-calculo" text="Total Gravado:" GridPane.rowIndex="4" />
                        <TextField fx:id="lblTotGravada" alignment="CENTER_RIGHT" editable="false" styleClass="campo-readonly" text="0.00" GridPane.columnIndex="1" GridPane.rowIndex="4" />
                  <rowConstraints>
                     <RowConstraints />
                     <RowConstraints />
                     <RowConstraints />
                     <RowConstraints />
                     <RowConstraints />
                  </rowConstraints>
                    </GridPane>

                    <!-- Total Principal -->
                    <VBox alignment="CENTER" prefHeight="218.0" prefWidth="327.0" styleClass="panel-total">
                        <padding>
                            <Insets bottom="20" left="30" right="30" top="20" />
                        </padding>
                        <Label prefHeight="27.0" prefWidth="148.0" styleClass="label-total-titulo" text="TOTAL A PAGAR" />
                        <Label fx:id="lblTotal" alignment="CENTER" prefHeight="54.0" prefWidth="285.0" styleClass="label-total-monto" text="S/ 0.00" />
                  <Button fx:id="btnPagar" maxWidth="Infinity" onAction="#realizarPago" styleClass="btn-comprobante" text="PAGAR">
                     <tooltip>
                        <Tooltip text="Generar Factura" />
                     </tooltip>
                  </Button>
                    </VBox>
                </HBox>
            </VBox>

            <!-- ================================== -->
            <!-- PANEL DERECHO: BSQUEDA PRODUCTOS -->
            <!-- ================================== -->
            <VBox spacing="8" styleClass="panel-busqueda" HBox.hgrow="NEVER">
                <HBox.margin>
                    <Insets left="5" />
                </HBox.margin>

                <Label styleClass="titulo-panel" text="Cat谩logo de Productos" />

                <TextField fx:id="txtDesArinda1" onKeyPressed="#buscarArinda1" promptText=" Buscar producto...">
                    <tooltip>
                        <Tooltip text="Buscar por nombre, c贸digo o descripci贸n" />
                    </tooltip>
                </TextField>

                <TableView fx:id="tArinda1" onKeyPressed="#tArinda1KeyPressed" onMouseClicked="#tArinda1MouseClicked" styleClass="tabla-catalogo" VBox.vgrow="ALWAYS">
                    <columns>
                        <TableColumn fx:id="colProducto" text="Producto" />
                    </columns>
                    <placeholder>
                        <Label styleClass="placeholder-text" text="No se encontraron productos" />
                    </placeholder>
                </TableView>

                <Label styleClass="hint-text" text="Doble clic para agregar" />
            </VBox>
        </HBox>
    </center>
</BorderPane>
